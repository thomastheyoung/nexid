var T=Object.defineProperty;var W=(r,e,t)=>e in r?T(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var C=(r,e,t)=>W(r,typeof e!="symbol"?e+"":e,t);var D="0123456789abcdefghijklmnopqrstuv",f=20,$=12,i=255,X=65535,a=new Uint8Array(Array.from(D).map(r=>r.charCodeAt(0))),S=(()=>{const r=new Uint8Array(123).fill(255);for(let e=0;e<D.length;e++)r[D.charCodeAt(e)]=e;return r})(),x=new Array(f);function B(r){const e=x,t=r[0],n=r[1],o=r[2],s=r[3],c=r[4],g=r[5],d=r[6],h=r[7],y=r[8],v=r[9],I=r[10],w=r[11];return e[19]=a[w<<4&31],e[18]=a[w>>1&31],e[17]=a[(w>>6|I<<2)&31],e[16]=a[I>>3&31],e[15]=a[v&31],e[14]=a[(v>>5|y<<3)&31],e[13]=a[y>>2&31],e[12]=a[(y>>7|h<<1)&31],e[11]=a[(h>>4|d<<4)&31],e[10]=a[d>>1&31],e[9]=a[(d>>6|g<<2)&31],e[8]=a[g>>3&31],e[7]=a[c&31],e[6]=a[(c>>5|s<<3)&31],e[5]=a[s>>2&31],e[4]=a[(s>>7|o<<1)&31],e[3]=a[(o>>4|n<<4)&31],e[2]=a[n>>1&31],e[1]=a[(n>>6|t<<2)&31],e[0]=a[t>>3&31],String.fromCharCode.apply(null,e)}function G(r){if(!r||r.length!==f)throw new Error(`Invalid XID length: expected ${f}, got ${(r==null?void 0:r.length)||0}`);const e=new Uint8Array($),t=new Uint8Array(f);for(let n=0;n<f;n++)t[n]=r.charCodeAt(n);try{const n=new Uint8Array(f);for(let o=0;o<f;o++){const s=t[o],c=S[s];if(c===255)throw new Error(`Invalid character '${r[o]}' at position ${o}`);n[o]=c}if(e[0]=n[0]<<3|n[1]>>2,e[1]=n[1]<<6|n[2]<<1|n[3]>>4,e[2]=n[3]<<4|n[4]>>1,e[3]=n[4]<<7|n[5]<<2|n[6]>>3,e[4]=n[6]<<5|n[7],e[5]=n[8]<<3|n[9]>>2,e[6]=n[9]<<6|n[10]<<1|n[11]>>4,e[7]=n[11]<<4|n[12]>>1,e[8]=n[12]<<7|n[13]<<2|n[14]>>3,e[9]=n[14]<<5|n[15],e[10]=n[16]<<3|n[17]>>2,e[11]=n[17]<<6|n[18]<<1|n[19]>>4,D[e[11]<<4&31]!==r[19])throw new Error("XID consistency check failed");return e}catch(n){if(n instanceof Error&&n.message.includes("Invalid character"))throw n;if(n instanceof Error&&n.message.includes("out of range"))for(let o=0;o<f;o++){const s=t[o];if(s>=S.length||S[s]===255)throw new Error(`Invalid character '${r[o]}' (code ${s}) at position ${o}`)}throw new Error(`XID decoding error: ${n instanceof Error?n.message:String(n)}`)}}var H=class k{constructor(e){this.bytes=e}static fromBytes(e){if(!(e instanceof Uint8Array))throw new Error("ID is not a Uint8Array");if(e.length!==$)throw new Error("Invalid id length");return new k(e)}static fromString(e){if(e.length!==f)throw new Error("Invalid id length");if(!/[0-9a-v]{20}/.test(e))throw new Error("Invalid string id (must be 20 chars, 0-9 a-v");return new k(G(e))}static nilID(){return new k(new Uint8Array($))}get time(){const e=this.bytes,t=e[0]<<24|e[1]<<16|e[2]<<8|e[3];return new Date(t*1e3)}get machineId(){return this.bytes.slice(4,7)}get processId(){const e=this.bytes;return e[7]<<8|e[8]}get counter(){const e=this.bytes;return e[9]<<16|e[10]<<8|e[11]}toString(){return B(this.bytes)}isNil(){return this.bytes.every(e=>e===0)}equals(e){return this===e?!0:this.bytes.every((t,n)=>t===e.bytes[n])}};function O(r){let e;globalThis.SharedArrayBuffer?e=new SharedArrayBuffer(4):globalThis.WebAssembly?e=new WebAssembly.Memory({initial:1,maximum:1,shared:!0}).buffer:e=new ArrayBuffer(4);const t=new Uint32Array(e);return t[0]=r,{getNext(){const n=Atomics.add(t,0,1);return n===0&&(t[0]=r&65535),n&16777215}}}async function _(r,e={}){const t=await r.get("RandomBytes",e.randomBytes||null),n=await r.get("HashFunction"),s=await(await r.get("MachineId",e.machineId?async()=>e.machineId:null))(),c=(await n(s)).subarray(0,3),d=await(await r.get("ProcessId",e.processId?async()=>e.processId:null))()&65535,h=new Uint8Array($);h[4]=c[0]&i,h[5]=c[1]&i,h[6]=c[2]&i,h[7]=d>>8&i,h[8]=d&i;const y=t(3),v=t(3),I=t(3),w=y[0]<<16|v[1]<<8|I[2],N=O(w);function M(u){const l=new Uint8Array(h);u=Math.floor(u/1e3),l[0]=u>>24&i,l[1]=u>>16&i,l[2]=u>>8&i,l[3]=u&i;const E=N.getNext();return l[9]=E>>16&i,l[10]=E>>8&i,l[11]=E&i,l}return{machineId:s,processId:d,newId(u){const l=u instanceof Date?+u:Date.now();return H.fromBytes(M(l))},fastId(){return B(M(Date.now()))}}}var F={async test(r){if(typeof r!="function")return!1;try{const e=await r("custom-hash-test");return e instanceof Uint8Array&&e.length===32}catch{return!1}},async fallback(r){console.warn("Using non-secure fallback (hash)");const e=typeof r=="string"?r:r.toString();let t=2166136261;for(let o=0;o<e.length;o++)t^=e.charCodeAt(o),t=t*16777619>>>0;const n=new Uint8Array(32);for(let o=0;o<32;o++)n[o]=(t^o*83)+o&255;return n}},L={async test(r){if(typeof r!="function")return!1;try{const e=await r();return!!e&&typeof e=="string"&&e.length>0}catch{return!1}},async fallback(){console.warn("Using non-secure fallback (machine id)");const r=Date.now().toString(36),e=()=>Math.random().toString(36).substring(2,10);return`${e()}-${r}-${e()}`}},P={async test(r){if(typeof r!="function")return!1;try{const e=await r();return typeof e=="number"&&e>0}catch{return!1}},async fallback(){return console.warn("Using non-secure fallback (process id)"),Math.floor(Math.random()*65535)+1}},z={async test(r){if(typeof r!="function")return!1;try{const e=r(5);return e instanceof Uint8Array&&e.length===5}catch{return!1}},fallback(r){console.warn("Using non-secure fallback (randomBytes)");const e=new Uint8Array(r);for(let t=0;t<r;t++)e[t]=Math.floor(Math.random()*256);return e}},j={RandomBytes:z,HashFunction:F,MachineId:L,ProcessId:P},K=class{constructor(r){C(this,"cache",new Map);this.adapter=r}async get(r,e){const t=j[r];if(e&&await t.test(e))return this.cache.set(r,e),e;if(this.cache.has(r))return this.cache.get(r);const n=this.adapter[r];return await t.test(n)?(this.cache.set(r,n),n):t.fallback}},q=async r=>{typeof r=="string"&&(r=new TextEncoder().encode(r));const e=await globalThis.crypto.subtle.digest("SHA-256",r);return new Uint8Array(e)};async function V(){const r=[],e=(Math.random()*65535|0).toString(16).padStart(2,"0"),t=Date.now().toString(36);return r.push(`salt: ${e}:${t}`),r.push(`env:${Y()}`),b(navigator)&&(r.push(`ua:${navigator.userAgent||""}`),r.push(`lang:${navigator.language||""}`),navigator.languages&&Array.isArray(navigator.languages)&&r.push(`langs:${navigator.languages.join(",")}`),"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency&&r.push(`cores:${navigator.hardwareConcurrency}`),"deviceMemory"in navigator&&navigator.deviceMemory&&r.push(`mem:${navigator.deviceMemory}`)),b(screen)&&(r.push(`colorDepth:${screen.colorDepth}`),r.push(`width:${screen.width}`),r.push(`height:${screen.height}`),screen.availWidth&&r.push(`availWidth:${screen.availWidth}`),screen.availHeight&&r.push(`availHeight:${screen.availHeight}`)),r.push(`tz:${new Date().getTimezoneOffset()}`),r.filter(Boolean).join("||")}function Y(){return b(window)&&b(document)?"browser":b(self)&&typeof importScripts=="function"?U(self,ServiceWorkerGlobalScope)?"service-worker":U(self,DedicatedWorkerGlobalScope)?"dedicated-worker":U(self,SharedWorkerGlobalScope)?"shared-worker":"web-worker":"unknown"}function b(r){return typeof r<"u"}function U(r,e){return typeof e<"u"&&r instanceof e}var J=async()=>Math.floor(Math.random()*(X-255+1))+255,Q=r=>{const e=new Uint8Array(r);return globalThis.crypto.getRandomValues(e)},Z=new K({RandomBytes:Q,HashFunction:q,MachineId:V,ProcessId:J});async function ee(r){return _(Z,r)}var re={init:ee};const p="oklch(27.4% 0.006 286.033)",ne="oklch(92.9% 0.013 255.508)",te="oklch(57.7% 0.245 27.325)",oe="oklch(70.4% 0.191 22.216)",ae={cyan:"oklch(71.5% 0.143 215.221)",lime:"oklch(84.1% 0.238 128.85)",amber:"oklch(82.8% 0.189 84.429)",fuchsia:"oklch(59.1% 0.293 322.896)",teal:"oklch(60% 0.118 184.704)",green:"oklch(62.7% 0.194 149.214)",sky:"oklch(74.6% 0.16 232.661)",indigo:"oklch(51.1% 0.262 276.966)",violet:"oklch(54.1% 0.281 293.009)",pink:"oklch(59.2% 0.249 0.584)",blue:"oklch(62.3% 0.214 259.815)",orange:"oklch(75% 0.183 55.934)",emerald:"oklch(59.6% 0.145 163.225)"};function se(r,e){return{log(...t){console.log(`%c[${e}]%c`,`background: ${p}; color: ${ae[r]}; font-weight: bold; line-height: 1rem;`,`background: ${p}; color: ${ne}; line-height: 1rem`,...t)},error(...t){console.error(`%c[${e}]%c`,`background: ${p}; color: ${te}; font-weight: bold; line-height: 1rem;`,`background: ${p}; color: ${oe}; line-height: 1rem`,...t)}}}let A;const m=se("orange","SW:Worker");async function R(){try{A=await re.init(),m.log("XID generator initialized")}catch(r){return console.error("Failed to initialize XID generator",r),!1}return!0}function ie(r){return function(t,n){r.postMessage({type:t,payload:n})}}self.addEventListener("install",r=>{m.log("Installing..."),self.skipWaiting(),r.waitUntil(R())});self.addEventListener("activate",r=>{m.log("Activating..."),r.waitUntil(self.clients.claim()),m.log("Activated")});self.addEventListener("message",async r=>{const e=r.source;if(!e)throw new Error("Unknown sender");const t=ie(e);if(!A&&!await R()){t("error",{message:"Unable to initialize NeXID generator"});return}try{const n=r.data;switch(n.type){case"new-xid":t("result:xid",{xid:A.fastId()});return;case"new-batch":{const o=performance.now(),s=new Array(n.payload.size).map(A.fastId),g=performance.now()-o;t("result:batch",{xids:s,time:g})}return}}catch(n){const o=`Error processing message '${r.data}'`;console.error(o,n),t("error",{message:o})}});m.log(`Script loaded (${self.serviceWorker.scriptURL})`);
