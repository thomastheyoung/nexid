var se=Object.defineProperty;var ce=(i,h,w)=>h in i?se(i,h,{enumerable:!0,configurable:!0,writable:!0,value:w}):i[h]=w;var T=(i,h,w)=>ce(i,typeof h!="symbol"?h+"":h,w);(function(){"use strict";const i="oklch(27.4% 0.006 286.033)",h="oklch(92.9% 0.013 255.508)",w="oklch(57.7% 0.245 27.325)",X="oklch(70.4% 0.191 22.216)",x={cyan:"oklch(71.5% 0.143 215.221)",lime:"oklch(84.1% 0.238 128.85)",amber:"oklch(82.8% 0.189 84.429)",fuchsia:"oklch(59.1% 0.293 322.896)",teal:"oklch(60% 0.118 184.704)",green:"oklch(62.7% 0.194 149.214)",sky:"oklch(74.6% 0.16 232.661)",indigo:"oklch(51.1% 0.262 276.966)",violet:"oklch(54.1% 0.281 293.009)",pink:"oklch(59.2% 0.249 0.584)",blue:"oklch(62.3% 0.214 259.815)",orange:"oklch(75% 0.183 55.934)",emerald:"oklch(59.6% 0.145 163.225)"};function G(r,e){return{log(...n){console.log(`%c[${e}]%c`,`background: ${i}; color: ${x[r]}; font-weight: bold; line-height: 1rem;`,`background: ${i}; color: ${h}; line-height: 1rem`,...n)},error(...n){console.error(`%c[${e}]%c`,`background: ${i}; color: ${w}; font-weight: bold; line-height: 1rem;`,`background: ${i}; color: ${X}; line-height: 1rem`,...n)}}}var p="0123456789abcdefghijklmnopqrstuv",u=20,A=12,c=255,H=65535,o=new Uint8Array(Array.from(p).map(r=>r.charCodeAt(0))),S=(()=>{const r=new Uint8Array(123).fill(255);for(let e=0;e<p.length;e++)r[p.charCodeAt(e)]=e;return r})(),O=new Array(u);function R(r){const e=O,n=r[0],t=r[1],a=r[2],s=r[3],f=r[4],U=r[5],y=r[6],d=r[7],v=r[8],D=r[9],$=r[10],I=r[11];return e[19]=o[I<<4&31],e[18]=o[I>>1&31],e[17]=o[(I>>6|$<<2)&31],e[16]=o[$>>3&31],e[15]=o[D&31],e[14]=o[(D>>5|v<<3)&31],e[13]=o[v>>2&31],e[12]=o[(v>>7|d<<1)&31],e[11]=o[(d>>4|y<<4)&31],e[10]=o[y>>1&31],e[9]=o[(y>>6|U<<2)&31],e[8]=o[U>>3&31],e[7]=o[f&31],e[6]=o[(f>>5|s<<3)&31],e[5]=o[s>>2&31],e[4]=o[(s>>7|a<<1)&31],e[3]=o[(a>>4|t<<4)&31],e[2]=o[t>>1&31],e[1]=o[(t>>6|n<<2)&31],e[0]=o[n>>3&31],String.fromCharCode.apply(null,e)}function W(r){if(!r||r.length!==u)throw new Error(`Invalid XID length: expected ${u}, got ${(r==null?void 0:r.length)||0}`);const e=new Uint8Array(A),n=new Uint8Array(u);for(let t=0;t<u;t++)n[t]=r.charCodeAt(t);try{const t=new Uint8Array(u);for(let a=0;a<u;a++){const s=n[a],f=S[s];if(f===255)throw new Error(`Invalid character '${r[a]}' at position ${a}`);t[a]=f}if(e[0]=t[0]<<3|t[1]>>2,e[1]=t[1]<<6|t[2]<<1|t[3]>>4,e[2]=t[3]<<4|t[4]>>1,e[3]=t[4]<<7|t[5]<<2|t[6]>>3,e[4]=t[6]<<5|t[7],e[5]=t[8]<<3|t[9]>>2,e[6]=t[9]<<6|t[10]<<1|t[11]>>4,e[7]=t[11]<<4|t[12]>>1,e[8]=t[12]<<7|t[13]<<2|t[14]>>3,e[9]=t[14]<<5|t[15],e[10]=t[16]<<3|t[17]>>2,e[11]=t[17]<<6|t[18]<<1|t[19]>>4,p[e[11]<<4&31]!==r[19])throw new Error("XID consistency check failed");return e}catch(t){if(t instanceof Error&&t.message.includes("Invalid character"))throw t;if(t instanceof Error&&t.message.includes("out of range"))for(let a=0;a<u;a++){const s=n[a];if(s>=S.length||S[s]===255)throw new Error(`Invalid character '${r[a]}' (code ${s}) at position ${a}`)}throw new Error(`XID decoding error: ${t instanceof Error?t.message:String(t)}`)}}var _=class E{constructor(e){this.bytes=e}static fromBytes(e){if(!(e instanceof Uint8Array))throw new Error("ID is not a Uint8Array");if(e.length!==A)throw new Error("Invalid id length");return new E(e)}static fromString(e){if(e.length!==u)throw new Error("Invalid id length");if(!/[0-9a-v]{20}/.test(e))throw new Error("Invalid string id (must be 20 chars, 0-9 a-v");return new E(W(e))}static nilID(){return new E(new Uint8Array(A))}get time(){const e=this.bytes,n=e[0]<<24|e[1]<<16|e[2]<<8|e[3];return new Date(n*1e3)}get machineId(){return this.bytes.slice(4,7)}get processId(){const e=this.bytes;return e[7]<<8|e[8]}get counter(){const e=this.bytes;return e[9]<<16|e[10]<<8|e[11]}toString(){return R(this.bytes)}isNil(){return this.bytes.every(e=>e===0)}equals(e){return this===e?!0:this.bytes.every((n,t)=>n===e.bytes[t])}};function F(r){let e;globalThis.SharedArrayBuffer?e=new SharedArrayBuffer(4):globalThis.WebAssembly?e=new WebAssembly.Memory({initial:1,maximum:1,shared:!0}).buffer:e=new ArrayBuffer(4);const n=new Uint32Array(e);return n[0]=r,{getNext(){const t=Atomics.add(n,0,1);return t===0&&(n[0]=r&65535),t&16777215}}}async function P(r,e={}){const n=await r.get("RandomBytes",e.randomBytes||null),t=await r.get("HashFunction"),s=await(await r.get("MachineId",e.machineId?async()=>e.machineId:null))(),f=(await t(s)).subarray(0,3),y=await(await r.get("ProcessId",e.processId?async()=>e.processId:null))()&65535,d=new Uint8Array(A);d[4]=f[0]&c,d[5]=f[1]&c,d[6]=f[2]&c,d[7]=y>>8&c,d[8]=y&c;const v=n(3),D=n(3),$=n(3),I=v[0]<<16|D[1]<<8|$[2],oe=F(I);function N(g){const l=new Uint8Array(d);g=Math.floor(g/1e3),l[0]=g>>24&c,l[1]=g>>16&c,l[2]=g>>8&c,l[3]=g&c;const B=oe.getNext();return l[9]=B>>16&c,l[10]=B>>8&c,l[11]=B&c,l}return{machineId:s,processId:y,newId(g){const l=g instanceof Date?+g:Date.now();return _.fromBytes(N(l))},fastId(){return R(N(Date.now()))}}}var z={async test(r){if(typeof r!="function")return!1;try{const e=await r("custom-hash-test");return e instanceof Uint8Array&&e.length===32}catch{return!1}},async fallback(r){console.warn("Using non-secure fallback (hash)");const e=typeof r=="string"?r:r.toString();let n=2166136261;for(let a=0;a<e.length;a++)n^=e.charCodeAt(a),n=n*16777619>>>0;const t=new Uint8Array(32);for(let a=0;a<32;a++)t[a]=(n^a*83)+a&255;return t}},L={async test(r){if(typeof r!="function")return!1;try{const e=await r();return!!e&&typeof e=="string"&&e.length>0}catch{return!1}},async fallback(){console.warn("Using non-secure fallback (machine id)");const r=Date.now().toString(36),e=()=>Math.random().toString(36).substring(2,10);return`${e()}-${r}-${e()}`}},j={async test(r){if(typeof r!="function")return!1;try{const e=await r();return typeof e=="number"&&e>0}catch{return!1}},async fallback(){return console.warn("Using non-secure fallback (process id)"),Math.floor(Math.random()*65535)+1}},K={async test(r){if(typeof r!="function")return!1;try{const e=r(5);return e instanceof Uint8Array&&e.length===5}catch{return!1}},fallback(r){console.warn("Using non-secure fallback (randomBytes)");const e=new Uint8Array(r);for(let n=0;n<r;n++)e[n]=Math.floor(Math.random()*256);return e}},q={RandomBytes:K,HashFunction:z,MachineId:L,ProcessId:j},V=class{constructor(r){T(this,"cache",new Map);this.adapter=r}async get(r,e){const n=q[r];if(e&&await n.test(e))return this.cache.set(r,e),e;if(this.cache.has(r))return this.cache.get(r);const t=this.adapter[r];return await n.test(t)?(this.cache.set(r,t),t):n.fallback}},Y=async r=>{typeof r=="string"&&(r=new TextEncoder().encode(r));const e=await globalThis.crypto.subtle.digest("SHA-256",r);return new Uint8Array(e)};async function J(){const r=[],e=(Math.random()*65535|0).toString(16).padStart(2,"0"),n=Date.now().toString(36);return r.push(`salt: ${e}:${n}`),r.push(`env:${Q()}`),b(navigator)&&(r.push(`ua:${navigator.userAgent||""}`),r.push(`lang:${navigator.language||""}`),navigator.languages&&Array.isArray(navigator.languages)&&r.push(`langs:${navigator.languages.join(",")}`),"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency&&r.push(`cores:${navigator.hardwareConcurrency}`),"deviceMemory"in navigator&&navigator.deviceMemory&&r.push(`mem:${navigator.deviceMemory}`)),b(screen)&&(r.push(`colorDepth:${screen.colorDepth}`),r.push(`width:${screen.width}`),r.push(`height:${screen.height}`),screen.availWidth&&r.push(`availWidth:${screen.availWidth}`),screen.availHeight&&r.push(`availHeight:${screen.availHeight}`)),r.push(`tz:${new Date().getTimezoneOffset()}`),r.filter(Boolean).join("||")}function Q(){return b(window)&&b(document)?"browser":b(self)&&typeof importScripts=="function"?C(self,ServiceWorkerGlobalScope)?"service-worker":C(self,DedicatedWorkerGlobalScope)?"dedicated-worker":C(self,SharedWorkerGlobalScope)?"shared-worker":"web-worker":"unknown"}function b(r){return typeof r<"u"}function C(r,e){return typeof e<"u"&&r instanceof e}var Z=async()=>Math.floor(Math.random()*(H-255+1))+255,ee=r=>{const e=new Uint8Array(r);return globalThis.crypto.getRandomValues(e)},re=new V({RandomBytes:ee,HashFunction:Y,MachineId:J,ProcessId:Z});async function te(r){return P(re,r)}var ne={init:te};const M=G("cyan","dedicated-worker");let k;async function ae(){try{k=await ne.init(),M.log("XID generator initialized")}catch(r){return M.error("Failed to initialize XID generator",r),!1}return!0}function m(r,e){self.postMessage({type:r,payload:e})}self.addEventListener("message",async r=>{if(!k&&!await ae()){m("error",{message:"Unable to initialize NeXID generator"});return}try{const e=r.data;switch(e.type){case"init":m("ready");return;case"new-xid":m("xid-generated",{xid:k.fastId()});return;case"new-batch":{const n=performance.now(),t=new Array(e.payload.size).map(k.fastId),s=performance.now()-n;m("batch-generated",{xids:t,time:s})}return}}catch(e){const n=`Error processing message '${r.data}'`;M.error(n,e),m("error",{message:n})}})})();
