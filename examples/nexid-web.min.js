"use strict";var NeXID=(()=>{var v=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var V=Object.prototype.hasOwnProperty;var j=(t,e)=>{for(var n in e)v(t,n,{get:e[n],enumerable:!0})},K=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of L(e))!V.call(t,o)&&o!==n&&v(t,o,{get:()=>e[o],enumerable:!(r=_(e,o))||r.enumerable});return t};var z=t=>K(v({},"__esModule",{value:!0}),t);var te={};j(te,{XID:()=>y,default:()=>ee,init:()=>Z});var P=async t=>{typeof t=="string"&&(t=new TextEncoder().encode(t));let e=await globalThis.crypto.subtle.digest("SHA-256",t);return new Uint8Array(e)};async function U(){let t=[],e=(Math.random()*65535|0).toString(16).padStart(2,"0"),n=Date.now().toString(36);return t.push(`salt: ${e}:${n}`),t.push(`env:${Y()}`),g(navigator)&&(t.push(`ua:${navigator.userAgent||""}`),t.push(`lang:${navigator.language||""}`),navigator.languages&&Array.isArray(navigator.languages)&&t.push(`langs:${navigator.languages.join(",")}`),"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency&&t.push(`cores:${navigator.hardwareConcurrency}`),"deviceMemory"in navigator&&navigator.deviceMemory&&t.push(`mem:${navigator.deviceMemory}`)),g(screen)&&(t.push(`colorDepth:${screen.colorDepth}`),t.push(`width:${screen.width}`),t.push(`height:${screen.height}`),screen.availWidth&&t.push(`availWidth:${screen.availWidth}`),screen.availHeight&&t.push(`availHeight:${screen.availHeight}`)),t.push(`tz:${new Date().getTimezoneOffset()}`),t.filter(Boolean).join("||")}function Y(){return g(window)&&g(document)?"browser":g(self)&&typeof importScripts=="function"?E(self,ServiceWorkerGlobalScope)?"service-worker":E(self,DedicatedWorkerGlobalScope)?"dedicated-worker":E(self,SharedWorkerGlobalScope)?"shared-worker":"web-worker":"unknown"}function g(t){return typeof t<"u"}function E(t,e){return typeof e<"u"&&t instanceof e}var b="0123456789abcdefghijklmnopqrstuv";var k=async()=>Math.random()*65535;var N=t=>{let e=new Uint8Array(t);return globalThis.crypto.getRandomValues(e)};var a=new Uint8Array(Array.from(b).map(t=>t.charCodeAt(0))),B=(()=>{let t=new Uint8Array(123).fill(255);for(let e=0;e<b.length;e++)t[b.charCodeAt(e)]=e;return t})(),q=new Array(20);function x(t){let e=q,n=t[0],r=t[1],o=t[2],i=t[3],f=t[4],F=t[5],h=t[6],u=t[7],p=t[8],w=t[9],I=t[10],d=t[11];return e[19]=a[d<<4&31],e[18]=a[d>>1&31],e[17]=a[(d>>6|I<<2)&31],e[16]=a[I>>3&31],e[15]=a[w&31],e[14]=a[(w>>5|p<<3)&31],e[13]=a[p>>2&31],e[12]=a[(p>>7|u<<1)&31],e[11]=a[(u>>4|h<<4)&31],e[10]=a[h>>1&31],e[9]=a[(h>>6|F<<2)&31],e[8]=a[F>>3&31],e[7]=a[f&31],e[6]=a[(f>>5|i<<3)&31],e[5]=a[i>>2&31],e[4]=a[(i>>7|o<<1)&31],e[3]=a[(o>>4|r<<4)&31],e[2]=a[r>>1&31],e[1]=a[(r>>6|n<<2)&31],e[0]=a[n>>3&31],String.fromCharCode.apply(null,e)}function X(t){if(!t||t.length!==20)throw new Error(`Invalid XID length: expected ${20}, got ${t?.length||0}`);let e=new Uint8Array(12),n=new Uint8Array(20);for(let r=0;r<20;r++)n[r]=t.charCodeAt(r);try{let r=new Uint8Array(20);for(let o=0;o<20;o++){let i=n[o],f=B[i];if(f===255)throw new Error(`Invalid character '${t[o]}' at position ${o}`);r[o]=f}if(e[0]=r[0]<<3|r[1]>>2,e[1]=r[1]<<6|r[2]<<1|r[3]>>4,e[2]=r[3]<<4|r[4]>>1,e[3]=r[4]<<7|r[5]<<2|r[6]>>3,e[4]=r[6]<<5|r[7],e[5]=r[8]<<3|r[9]>>2,e[6]=r[9]<<6|r[10]<<1|r[11]>>4,e[7]=r[11]<<4|r[12]>>1,e[8]=r[12]<<7|r[13]<<2|r[14]>>3,e[9]=r[14]<<5|r[15],e[10]=r[16]<<3|r[17]>>2,e[11]=r[17]<<6|r[18]<<1|r[19]>>4,b[e[11]<<4&31]!==t[19])throw new Error("XID consistency check failed");return e}catch(r){if(r instanceof Error&&r.message.includes("Invalid character"))throw r;if(r instanceof Error&&r.message.includes("out of range"))for(let o=0;o<20;o++){let i=n[o];if(i>=B.length||B[i]===255)throw new Error(`Invalid character '${t[o]}' (code ${i}) at position ${o}`)}throw new Error(`XID decoding error: ${r instanceof Error?r.message:String(r)}`)}}var y=class t{constructor(e){this.bytes=e}static fromBytes(e){if(!(e instanceof Uint8Array))throw new Error("ID is not a Uint8Array");if(e.length!==12)throw new Error("Invalid id length");return new t(e)}static fromString(e){if(e.length!==20)throw new Error("Invalid id length");if(!/[0-9a-v]{20}/.test(e))throw new Error("Invalid string id (must be 20 chars, 0-9 a-v");return new t(X(e))}static nilID(){return new t(new Uint8Array(12))}get time(){let e=this.bytes,n=e[0]<<24|e[1]<<16|e[2]<<8|e[3];return new Date(n*1e3)}get machineId(){return this.bytes.slice(4,7)}get processId(){let e=this.bytes;return e[7]<<8|e[8]}get counter(){let e=this.bytes;return e[9]<<16|e[10]<<8|e[11]}toString(){return x(this.bytes)}isNil(){return this.bytes.every(e=>e===0)}equals(e){return this===e?!0:this.bytes.every((n,r)=>n===e.bytes[r])}};function $(t){let e;globalThis.SharedArrayBuffer?e=new SharedArrayBuffer(4):globalThis.WebAssembly?e=new WebAssembly.Memory({initial:1,maximum:1,shared:!0}).buffer:e=new ArrayBuffer(4);let n=new Uint32Array(e);return n[0]=t,{getNext(){let r=Atomics.add(n,0,1);return r===0&&(n[0]=t&65535),r&16777215}}}async function M(t,e={}){let n=await t.get("RandomBytes",e.randomBytes||null),r=await t.get("HashFunction"),i=await(await t.get("MachineId",e.machineId?async()=>e.machineId:null))(),f=(await r(i)).subarray(0,3),h=await(await t.get("ProcessId",e.processId?async()=>e.processId:null))()&65535,u=new Uint8Array(12);u[4]=f[0]&255,u[5]=f[1]&255,u[6]=f[2]&255,u[7]=h>>8&255,u[8]=h&255;let p=n(3),w=n(3),I=n(3),d=p[0]<<16|w[1]<<8|I[2],O=$(d);function C(l){let c=new Uint8Array(u);l=Math.floor(l/1e3),c[0]=l>>24&255,c[1]=l>>16&255,c[2]=l>>8&255,c[3]=l&255;let S=O.getNext();return c[9]=S>>16&255,c[10]=S>>8&255,c[11]=S&255,c}return{machineId:i,processId:h,newId(l){let c=l instanceof Date?+l:Date.now();return y.fromBytes(C(c))},fastId(){return x(C(Date.now()))}}}var R={async test(t){if(typeof t!="function")return!1;try{let e=await t("custom-hash-test");return e instanceof Uint8Array&&e.length===32}catch{return!1}},async fallback(t){console.warn("Using non-secure fallback (hash)");let e=typeof t=="string"?t:t.toString(),n=2166136261;for(let o=0;o<e.length;o++)n^=e.charCodeAt(o),n=n*16777619>>>0;let r=new Uint8Array(32);for(let o=0;o<32;o++)r[o]=(n^o*83)+o&255;return r}};var G={async test(t){if(typeof t!="function")return!1;try{let e=await t();return!!e&&typeof e=="string"&&e.length>0}catch{return!1}},async fallback(){console.warn("Using non-secure fallback (machine id)");let t=Date.now().toString(36),e=()=>Math.random().toString(36).substring(2,10);return`${e()}-${t}-${e()}`}};var T={async test(t){if(typeof t!="function")return!1;try{let e=await t();return typeof e=="number"&&e>0}catch{return!1}},async fallback(){return console.warn("Using non-secure fallback (process id)"),Math.floor(Math.random()*65535)+1}};var H={async test(t){if(typeof t!="function")return!1;try{let e=t(5);return e instanceof Uint8Array&&e.length===5}catch{return!1}},fallback(t){console.warn("Using non-secure fallback (randomBytes)");let e=new Uint8Array(t);for(let n=0;n<t;n++)e[n]=Math.floor(Math.random()*256);return e}};var J={RandomBytes:H,HashFunction:R,MachineId:G,ProcessId:T},A=class{constructor(e){this.adapter=e}cache=new Map;async get(e,n){let r=J[e];if(n&&await r.test(n))return console.log(`NeXID: using user's provided ${e}: ${n}`),this.cache.set(e,n),n;if(this.cache.has(e))return this.cache.get(e);let o=this.adapter[e];return await r.test(o)?(console.log(`NeXID: using adapter's implementation of ${e}`),this.cache.set(e,o),o):(console.log(`NeXID: using fallback ${e}`),r.fallback)}};var Q=new A({RandomBytes:N,HashFunction:P,MachineId:U,ProcessId:k});async function W(t){return console.log("NeXID: initializing with Web adapter"),M(Q,t)}var Z=W,ee={init:W};return z(te);})();
//# sourceMappingURL=nexid-web.min.js.map
